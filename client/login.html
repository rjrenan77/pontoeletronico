<!DOCTYPE html>
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> CRO-RJ Sistema de Ponto Eletrônico</title>
    <link rel="stylesheet" href="">
</head>

<body>
    <div>
        <form>
            <div>
                <p id="msgValidacao"></p>

                <p>Usuário</p>
                <input type="text" id="usuario" name="usuario" placeholder="Digite seu usuário..." />

                <p>Senha</p>
                <input type="password" id="senha" name="senha" placeholder="Digite sua senha ....">
                <p></p>

                <input type="checkbox" name="salvar" /> Salvar dados <br />

                <button type="submit" id="botaoLogin" name="botaoLogin">Entrar</button>

            </div>


        </form>

    </div>

    <script>
        window.enviarForm = function () {
          var usuario = document.querySelector('[name="usuario"]').value;
          var senha = document.querySelector('[name="senha"]').value;
          var salvar = document.querySelector('[name="salvar"]').checked;
      
      
            if(salvar){
              window.localStorage.setItem('usuario', usuario);
              window.localStorage.setItem('senha', senha);
            }
      
          return false;
        }
      
        var usuario = window.localStorage.getItem('usuario');
        var senha = window.localStorage.getItem('senha');
      
        if(usuario && senha){
            document.querySelector('[name="usuario"]').value = usuario;
            document.querySelector('[name="senha"]').value = senha;
        }
      </script>


    <script>

        document.getElementById("botaoLogin").addEventListener("click", function (event) {
            event.preventDefault();

            var formData = new FormData();

            var usuario = document.getElementById("usuario").value;
            var senha = document.getElementById("senha").value;
           


            formData.append("usuario", usuario);
            formData.append("senha", senha);
            

            var xhr = new XMLHttpRequest();

            xhr.onreadystatechange = function () {

                if (xhr.readyState == 4) {
                    var resposta = xhr.responseText;
                    console.log(resposta)

                    //talvez sirva para recarregar a pagina
                    xhr.onload = function () {
                        if (resposta === "401") {
                            var msgValidacao = document.getElementById("msgValidacao");
                            msgValidacao.innerHTML = "ATENÇÃO: Usuário ou Senha Inválidos!"


                        }

                        if (resposta === "autorizado") {
                            console.log("entraaaaa")
                            location.replace("./index.html");
                            // window.open("index.html","_blank");

                        }

                        if (resposta === "naoautorizado") {
                            var msgValidacao = document.getElementById("msgValidacao");
                            msgValidacao.innerHTML = "ATENÇÃO: Usuário ou Senha não autorizados. Procure o administrador do sistema."


                        }
                    }


                    //  document.write(Date());



                }
            }

            xhr.open("POST", "http://localhost:8080/api/autenticar");
            xhr.send(formData);

            // location.reload()


        });



    </script>

   
</body>

</html>